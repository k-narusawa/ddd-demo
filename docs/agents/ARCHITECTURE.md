# プロジェクトアーキテクチャ

## 1. 概要

このプロジェクトは、ドメイン駆動設計 (DDD) の原則に基づいた Kotlin + Spring Boot アプリケーションです。主な目的は、DDD
の概念を実践し、保守性と拡張性の高いソフトウェアを構築することです。

## 2. アーキテクチャスタイル

本プロジェクトでは、以下のアーキテクチャスタイルを組み合わせて採用しています。

- **ドメイン駆動設計 (DDD)**: ビジネスの関心事であるドメインを中心に設計を進めます。
- **レイヤードアーキテクチャ**: 関心事を分離するため、以下のレイヤーに分割しています。
    - アダプター層 (Adapter Layer)
    - アプリケーション層 (Application Layer)
    - ドメイン層 (Domain Layer)
- **クリーンアーキテクチャ / ヘキサゴナルアーキテクチャ**:
  依存関係の方向を内側（ドメイン層）に向け、フレームワークや外部サービスからドメインロジックを独立させます。

## 3. ディレクトリ構成

プロジェクトの主要なディレクトリ構成とそれぞれの役割は以下の通りです。

```
src/main/kotlin/dev/k_narusawa/ddd_demo/
├── app/
│   ├── identity_access/  # 認証・認可バウンデッドコンテキスト
│   │   ├── adapter/        # アダプター層 (Controller, Middleware)
│   │   ├── application/    # アプリケーション層 (Usecase, Port)
│   │   └── domain/         # ドメイン層 (Entity, ValueObject, Repository, DomainService)
│   └── task/             # タスク管理バウンデデッドコンテキスト
│       ├── adapter/
│       ├── application/
│       └── domain/
└── util/                 # 汎用ユーティリティ
```

## 4. 主要な概念と実装方針

### 4.1. ドメイン層 (`domain`)

ビジネスの核となるルールとロジックを配置します。このレイヤーは他のどのレイヤーにも依存しません。
詳細は、`docs/agents/DOMAIN.md` に記載された方針に従います。

### 4.2. アプリケーション層 (`application`)

ドメイン層のオブジェクトを操作し、アプリケーションのユースケースを実現します。

- **ユースケース (Usecase / Interactor)**:
    - アプリケーション固有のビジネスロジックを実装します。
    - `InputBoundary` (Port) を実装し、`InputData` を受け取って処理を実行し、`OutputData` を返却します。
    - 参考: `application/usecase/signup/SignupUserInteractor.kt`
- **ポート (Port)**:
    - アプリケーション層への入力（`InputBoundary`）と出力（`OutputBoundary`
      ）を定義するインターフェース。クリーンアーキテクチャにおけるポートに相当します。
- **DTO (Data Transfer Object)**:
    - レイヤー間でデータを転送するためのオブジェクト (`InputData`, `OutputData`)。

### 4.3. アダプター層 (`adapter`)

外部の世界（UI、データベース、外部APIなど）とアプリケーションをつなぐ責務を持ちます。

- **コントローラー (Controller)**:
    - HTTPリクエストを受け付け、アプリケーション層のユースケースを呼び出し、結果をHTTPレスポンスとして返却します。
    - 参考: `adapter/controller/SignupController.kt`
- **リポジトリ実装**:
    - ドメイン層で定義されたリポジトリインターフェースの実装。JPAなどを利用してデータベースとのやり取りを行います。
- **ミドルウェア / 例外ハンドラ**:
    - 認証、ロギング、エラーハンドリングなどの横断的な関心事を扱います。

## 5. バウンデッドコンテキスト

プロジェクトは以下のバウンデッドコンテキストに分割されています。

- **Identity & Access Context (`identity_access`)**:
    - ユーザー登録、ログイン、認証、認可など、ID管理とアクセス制御に関する責務を担います。
- **Task Context (`task`)**:
    - タスクの作成、更新、管理など、タスクに関連する責務を担います。

## 6. テスト

テストは、`docs/agents/TEST.md` に記載された方針に従います。

- **単体テスト**:
    - ドメイン層のエンティティや値オブジェクトなど、依存のないクラスを対象とします。
    - AAA (Arrange, Act, Assert) パターンに従います。
- **結合テスト**:
    - アプリケーションサービスやリポジトリ実装など、他のクラスに依存するクラスを対象とします。
    - `@SpringBootTest` を利用し、実際の依存関係を用いてテストします。
